@model List<ShopProject.Areas.Shopper.Models.ShoppingCartItems>
@{
    ViewBag.Title = "Thanh toán đơn hàng";
    Layout = "~/Areas/Shopper/Views/Shared/_LayoutShop.cshtml";
}

<div class="container">
    @if (Model == null || Model.Count == 0)
    {
        <div class="spec">
            <h3>Thanh toán</h3>
            <div class="ser-t">
                <b></b>
                <span><i></i></span>
                <b class="line"></b>
            </div>
        </div>
        <p class="text-info text-center" style="font-size:25px;">
            Giỏ hàng của bạn trống!
        </p>
    }
    else
    {
        <div class="spec">
            <h3>Thanh toán</h3>
            <div class="ser-t">
                <b></b>
                <span><i></i></span>
                <b class="line"></b>
            </div>
        </div>
        <div class="row">
            <div id="center_column" class="center_column">
                <div class="row">
                    <div id="left_column" class="column col-sm-12 col-md-12">
                        <div class="col-sm-6 col-md-6">
                            <div class="detail_ct">
                                <legend>Thông tin liên hệ</legend>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">Họ và tên *</label>
                                    <div class="col-lg-8">
                                        <input type="text" required name="fullname" class="form-control input-sm field" style="width:300px;" value="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">Email</label>
                                    <div class="col-lg-8">
                                        <input type="email" required placeholder="Không bắt buộc" class="form-control input-sm field" name="email" style="width:300px;" value="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">Số điện thoại *</label>
                                    <div class="col-lg-8">
                                        <input type="text" required class="form-control input-sm field" id="phone" name="phone" style="width:300px;" value="">
                                    </div>
                                </div>
                                <legend>Địa chỉ giao hàng</legend>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">Địa chỉ</label>
                                    <div class="col-lg-8">
                                        <textarea required class="form-control input-sm field" placeholder="Vui lòng ghi địa chỉ chi tiết..." name="address" rows="5" style="height:50px;"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">Ghi chú</label>
                                    <div class="col-lg-8">
                                        <textarea required class="form-control input-sm field" placeholder="Vui lòng ghi size của từng sản phẩm vào ô này..." name="note" rows="5" style="height:50px;"></textarea>
                                    </div>
                                </div><br /><br /><br /><br /><br /><br />
                                <fieldset>
                                    <div class="form-group">
                                        <label class="col-lg-4 control-label"></label>
                                        <div class="col-lg-8">
                                            <a id="submitStepEnd" class="btn btn-success" href="#">Thanh toán</a>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-6">
                            <div class="detail_ct" style="height:auto; min-height:inherit;">
                                <legend>Giỏ hàng của bạn</legend>
                                <table class="table" style="background:#FFF; font-size:18px;">
                                    <thead>
                                        <tr>
                                            <th>Hình</th>
                                            <th>Sản phẩm</th>
                                            <th>SL</th>
                                            <th>Đơn giá</th>
                                            <th>Thành tiền</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{
                                            decimal total = 0; // Declare total variable here
                                            if (Model != null && Model.Any())
                                            {
                                                foreach (var item in Model)
                                                {
                                                    <tr style="border-top:1px solid #999;">
                                                        <td>
                                                            <img src="@item.Products.proPhoto" width="48">
                                                        </td>
                                                        <td>
                                                            <strong>@item.Products.proName</strong>
                                                        </td>
                                                        <td>@item.quantity</td>
                                                        <td>@item.price VNĐ</td>
                                                        <td>@(item.quantity * decimal.Parse(item.price)) VNĐ</td>
                                                    </tr>
                                                    total += item.quantity * decimal.Parse(item.price);
                                                }
                                            }
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td colspan="6">
                                                <a class="btn btn-default hidden-xs" style="float:right;" href="@Url.Action("Index", "GioHang")">Quay về</a>
                                                <div class="clr"></div>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                                @if (Model != null && Model.Any())
                                {
                                    <fieldset>
                                        <legend>Tổng</legend>
                                        <table class="table" style="background:#FFF; font-size:20px;">
                                            <tbody>
                                                <tr>
                                                    <td align="right">Tổng tiền:</td>
                                                    <td style="color:red;" align="right">@total.ToString("#,##0") VNĐ</td>
                                                </tr>
                                            </tbody>
                                          
                                        </table>
                                    </fieldset>
                                }
                            </div>
                        </div>
                        <div class="clr"></div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#submitStepEnd').click(function (e) {
            e.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết

            // Lấy dữ liệu từ các trường nhập vào
            var fullname = $('input[name="fullname"]').val();
            var email = $('input[name="email"]').val();
            var phone = $('input[name="phone"]').val();
            var address = $('textarea[name="address"]').val();
            var note = $('textarea[name="note"]').val();

            // Kiểm tra xem các trường có dữ liệu không
            if (fullname && email && phone && address && note) {
                // Tạo một đối tượng dữ liệu để gửi đi
                var data = {
                    fullname: fullname,
                    email: email,
                    phone: phone,
                    address: address,
                    note: note
                };

                // Gửi yêu cầu POST đến action StepEnd trong controller ThanhToan
                $.post('@Url.Action("StepEnd", "ThanhToan")', data, function (response) {
                    // Xử lý kết quả từ action StepEnd ở đây
                    console.log(response);
                     // Chuyển hướng đến action HoaDon trong controller ThanhToan
 window.location.href = '@Url.Action("HoaDon", "ThanhToan")';
                });
            } else {
                // Hiển thị thông báo lỗi nếu có trường nào đó trống
                alert('Vui lòng điền đầy đủ thông tin');
            }
        });
    });
</script>
